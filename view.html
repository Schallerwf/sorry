<html>
<head>
<style>
table {
  width: 500px;
}
td {
  position: relative;
}
td:after {
  content: '';
  display: block;
  margin-top: 100%;
}
td .emptySpace {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid black;
  text-align: center;
  vertical-align: middle;
}
td .yellowSpace {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid black;
  text-align: center;
  vertical-align: middle;
}
td .greenSpace {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid black;
  text-align: center;
  vertical-align: middle;
}
td .blueSpace {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid black;
  text-align: center;
  vertical-align: middle;
}
td .redSpace {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid black;
  text-align: center;
  vertical-align: middle;
}

td .yellowPiece {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: gold;
  border: 1px solid black;
  margin: 5px;
}
td .greenPiece {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: green;
  border: 1px solid black;
  margin: 5px;
}
td .bluePiece {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: blue;
  border: 1px solid black;
  margin: 5px;
}
td .redPiece {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: red;
  border: 1px solid black;
  margin: 5px;
}

td .yellow {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: gold;
  border: 1px solid black;
  text-align:center;
}
td .green {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: green;
  border: 1px solid black;
  text-align:center;
}
td .red {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: red;
  border: 1px solid black;
  text-align:center;
}
td .blue {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: blue;
  border: 1px solid black;
  text-align:center;
}
td .yellowSafeSpace {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  border: 1px solid gold;
}
td .greenSafeSpace {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  border: 1px solid green;
}
td .redSafeSpace {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  border: 1px solid red;
}
td .blueSafeSpace {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  border: 1px solid blue;
}
td .empty {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  text-align:center;
}
</style>
<script>
var players = ["y","g","b","r"];
var colorToPlayer = {yellow: "y",
                     green:  "g",
                     blue:   "b",
                     red:    "r"};
var playerToColor = {y: "yellow",
                     g: "green",
                     b: "blue",
                     r: "red"};
var invalidSpaces = {y: [16,31,46,24,39,54],
                     g: [1,9,31,46,39,54],
                     b: [1,9,16,46,24,54],
                     r: [1,9,16,31,24,39]};
var pawns = {y:[],
             g:[],
             b:[],
             r:[]};
var placeStates = ["emptySpace", "yellowSpace", "greenSpace", "blueSpace", "redSpace"]

function removePawn(player, spot) {
  pawns[player] = pawns[player].filter(a => a !== spot)
}

function addPawn(player, spot) {
  pawns[player].push(spot);
}

function select(clickedId) {
  if (clickedId.startsWith("y") ||
      clickedId.startsWith("g") ||
      clickedId.startsWith("r") ||
      clickedId.startsWith("b")) {
    if (clickedId.length > 2) {
      selectSafeZone(clickedId);
    } else {
      selectStartOrHome(clickedId);
    }
  } else {
    selectPlace(clickedId);
  }
  updateMetadata();
}

function updateMetadata() {
  document.getElementById("metadata").innerHTML = JSON.stringify(pawns);

  errors = "";
  for (var i = 0; i < players.length; i++) {
    player = players[i];
    color = playerToColor[player];
    numPawnsInPlay = pawns[player].length;
    if (numPawnsInPlay > 4) {
      errors += "Player " + color + " has more than 4 pawns in play ("+numPawnsInPlay+")<br />";
    } else if (numPawnsInPlay < 4) {
       errors += "Player " + color + " has less than 4 pawns in play ("+numPawnsInPlay+")<br />";
    }

    for (var n = 0; n < pawns[player].length; n++) {
      if (invalidSpaces[player].includes(parseInt(pawns[player][n]))) {
        errors += "Player " + color + " has a pawn on the start of a slide.<br />";
      }
    }

  }
  document.getElementById("errors").innerHTML = errors;
}

function selectSafeZone(clickedId) {
  player = clickedId.charAt(0);
  elem = document.getElementById(clickedId);

  if (elem.innerHTML != "") {
    elem.innerHTML = "";
    removePawn(player, "safe:" + clickedId.slice(-1));
  } else {
    elem.innerHTML = "<div class=\""+elem.className.replace("SafeSpace","")+"Piece\"></div>";
    addPawn(player, "safe:" + clickedId.slice(-1));
  }
}

function selectPlace(clickedId) {
  elem = document.getElementById(clickedId);
  currentState = elem.className;
  currentColor = currentState.replace("Space","");
  currentNdx = placeStates.indexOf(currentState);
  nextNdx = (currentNdx + 1) % 5;
  nextState = placeStates[nextNdx];
  elem.className = nextState;
  nextColor = nextState.replace("Space","");
  player = colorToPlayer[nextColor];
  prevPlayer = colorToPlayer[currentColor];

  if (nextState != "emptySpace") {
    elem.innerHTML = "<div class=\""+nextColor+"Piece\"></div>";
    addPawn(player, "board:"+clickedId);
  } else {
    elem.innerHTML = "";
  }

  if (currentState != "emptySpace") {
    removePawn(prevPlayer, "board:"+clickedId);
  }
}

function selectStartOrHome(clickedId) {
  elem = document.getElementById(clickedId);
  currentValue = parseInt(elem.innerHTML);
  newValue = (currentValue + 1) % 5;
  elem.innerHTML = newValue;
  player = clickedId.charAt(0);

  if (clickedId.endsWith("h")) {
    removePawn(player, 'home');
    for (var i = 0; i < newValue; i++) {
      addPawn(player, 'home')
    }
  } else {
    removePawn(player, 'start');
    for (var i = 0; i < newValue; i++) {
      addPawn(player, 'start')
    }
  }
}
</script>
</head>
<body>
<table>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="0"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="1"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="2"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="3"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="4"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="5"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="6"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="7"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="8"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="9"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="10"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="11"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="12"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="13"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="14"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="15"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="59"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="yellowSafeSpace" onclick="select(this.id)" id="ys1"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="yellow" onclick="select(this.id)" id="ys">0</div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="16"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="58"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="yellowSafeSpace" onclick="select(this.id)" id="ys2"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="green" onclick="select(this.id)" id="gh">0</div></td>
    <td><div class="greenSafeSpace" onclick="select(this.id)" id="gs5"></div></td>
    <td><div class="greenSafeSpace" onclick="select(this.id)" id="gs4"></div></td>
    <td><div class="greenSafeSpace" onclick="select(this.id)" id="gs3"></div></td>
    <td><div class="greenSafeSpace" onclick="select(this.id)" id="gs2"></div></td>
    <td><div class="greenSafeSpace" onclick="select(this.id)" id="gs1"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="17"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="57"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="yellowSafeSpace" onclick="select(this.id)" id="ys3"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="18"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="56"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="yellowSafeSpace" onclick="select(this.id)" id="ys4"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="green" onclick="select(this.id)" id="gs">0</div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="19"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="15"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="yellowSafeSpace" onclick="select(this.id)" id="ys5"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="20"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="54"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="yellow" onclick="select(this.id)" id="yh">0</div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="21"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="53"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty">S</div></td>
    <td><div class="empty">O</div></td>
    <td><div class="empty">R</div></td>
    <td><div class="empty">R</div></td>
    <td><div class="empty">Y</div></td>
    <td><div class="empty">!</div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="22"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="52"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="23"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="51"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="blue" onclick="select(this.id)" id="bh">0</div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="24"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="50"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="blueSafeSpace" onclick="select(this.id)" id="bs5"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="25"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="49"></div></td>
    <td><div class="red" onclick="select(this.id)" id="rs">0</div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="blueSafeSpace" onclick="select(this.id)" id="bs4"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="26"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="48"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="blueSafeSpace" onclick="select(this.id)" id="bs3"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="27"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="47"></div></td>
    <td><div class="redSafeSpace" onclick="select(this.id)" id="rs1"></div></td>
    <td><div class="redSafeSpace" onclick="select(this.id)" id="rs2"></div></td>
    <td><div class="redSafeSpace" onclick="select(this.id)" id="rs3"></div></td>
    <td><div class="redSafeSpace" onclick="select(this.id)" id="rs4"></div></td>
    <td><div class="redSafeSpace" onclick="select(this.id)" id="rs5"></div></td>
    <td><div class="red" onclick="select(this.id)" id="rh">0</div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="blueSafeSpace" onclick="select(this.id)" id="bs2"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="28"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="46"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="blue" onclick="select(this.id)" id="bs">0</div></td>
    <td><div class="empty"></div></td>
    <td><div class="blueSafeSpace" onclick="select(this.id)" id="bs1"></div></td>
    <td><div class="empty"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="29"></div></td>
  </tr>
  <tr>
    <td><div class="emptySpace" onclick="select(this.id)" id="45"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="44"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="43"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="42"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="41"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="40"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="39"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="38"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="37"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="36"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="35"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="34"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="33"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="32"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="31"></div></td>
    <td><div class="emptySpace" onclick="select(this.id)" id="30"></div></td>
  </tr>
<table>
  <div id="metadata"></div>
  <div id="errors"></div>
</body>
</html>